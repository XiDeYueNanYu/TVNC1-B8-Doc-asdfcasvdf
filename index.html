<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>学习越南语请联系Wx:XiDeYueNanYu</title>
    <style>
        body {
            background-color: #f7fbf3;
            margin-bottom: 60px;
        }
        #infoBox { 
            width: 100%; 
            max-width: 700px;
            height: 100px; 
            margin: 0 auto; 
            border: 1px solid #ccc; 
            background: #68838B; 
            color: #D2B48C; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: clamp(40px, 5vw, 60px);
            font-weight: bold;
        }
        #contactBox { 
            width: 100%; 
            max-width: 700px;
            height: 45px; 
            margin: 0px auto; 
            border: 1px solid #ccc; 
            background: #68838B; 
            color: #D2B48C; 
            display: flex; 
            align-items: center; 
            justify-content: left; 
            padding-left: 20px;
            font-size: clamp(12px, 2vw, 15px); 
            font-weight: bold;
        }
        .image-frame {
            max-width: 700px;
            margin: 20px auto 0 auto;
            border: 10px solid #957652;
            border-radius: 10px;
            background-color: #ffffff;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            display: none;
            overflow: hidden;
        }
        .image-frame img {
            width: 100%;
            height: auto;
            display: block;
        }
        .content-box {
            max-width: 700px;
            margin: 20px auto;
            padding: 50px;
            border: 10px solid #957652;
            border-radius: 10px;
            background-color: #ffffff;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            font-size: 30px;
            font-family: Arial;
            color: #222322;
            line-height: 3;
            text-align: justify;
        }
        .translated-word {
            position: relative;
            display: inline-block;
            white-space: nowrap;
            line-height: 1.3;
            background-color: #bfcdbf;
            color: #000000;
            padding: 4px 4px;
            border-radius: 2px;
        }
        .translation {
            position: absolute;
            top: -29px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 18px;
            background-color: #eddabc;
            color: #313a2d;
            padding: 4px 4px;
            border-radius: 1px;
            white-space: nowrap;
            z-index: 1;
            line-height: 1;
        }
        .original {
            display: inline;
            line-height: 1;
        }
        .floating-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #f0f0f0;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            text-align: center;
            display: block;
            z-index: 1000;
        }
        #audioPlayer {
            width: 100%;
            margin-bottom: 10px;
        }
        .time-row {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        .time-box-group {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        .button-group {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        .floating-controls p#timeDisplay {
            font-size: 28px;
            color: #FFFFFF;
            background-color: #000000;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            margin: 0;
        }
        .floating-controls .time-box {
            font-size: 16px;
            color: #FFFFFF;
            background-color: #555555;
            padding: 5px 10px;
            border-radius: 5px;
            min-width: 60px;
        }
        .tua-buttons {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        .control-button {
            width: 50px;
            height: 50px;
            background-color: #363535;
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            display: inline-flex;
            justify-content: center;
            align-items: center;
        }
        .control-button:disabled {
            background-color: #888888;
            cursor: not-allowed;
        }
        .control-button:hover:not(:disabled) {
            background-color: #000000;
        }
        .pause-play-button {
            background-color: #FF4500;
        }
        .pause-play-button:hover {
            background-color: #CC3700;
        }
        .toggle-button {
            background-color: #4682B4;
        }
        .toggle-button:hover {
            background-color: #36648B;
        }
        .loop-button {
            background-color: #3c923c;
        }
        .loop-button:hover {
            background-color: #347d34;
        }
        .clear-button {
            background-color: #bc3f13;
        }
        .clear-button:hover {
            background-color: #d15124;
        }
        .active {
            background-color: #ffffff; 
            border-radius: 5px;
        }
        #quizContainer {
            display: none;
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            color: #53686f;
            font-size: 25px;
            font-weight: bold;
        }
        .question {
            margin-bottom: 20px;
            padding: 18px;
            color: #53686f;
            border: 5px solid #53686f;
            border-radius: 10px;
            background-color: #ffffff;
            font-size: 20px;
            font-weight: bold;
        }
        .options label {
            display: block;
            margin: 15px 0;
            cursor: pointer;
            color: #21292c;
            font-size: 16px;
            font-weight: bold;
        }
        #result {
            margin-top: 20px;
            padding: 10px;
            display: none;
            border: 5px solid #53686f;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            background-color: #ffffff;
            color: #007a33;
        }
        .wrong-answer {
            color: #f65936;
            margin: 10px 0;
            font-size: 16px;
            font-weight: bold;
        }
        #submitQuiz {
            font-family: Arial, sans-serif;
            padding: 10px 20px;
            border: 3px solid #53686f;
            background-color: #FF6820;
            border-radius: 5px;
            color: white;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
        }
        #submitQuiz:hover {
            background-color: #ff844a;
        }
        #vocabContainer {
            display: none;
            max-width: 700px;
            margin: 20px auto;
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        #vocabControls {
            position: fixed;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            width: 900px;
            background: #68838B;
            padding: 10px 0;
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            margin-bottom: 10px;
        }
        #vocabControls div {
            margin: 5px 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #vocabControls button {
            padding: 8px 8px;
            margin: 0 5px;
            cursor: pointer;
            border: 3px solid #5d757d;
            background: #0f1314;
            color: #fffbef;
            font-size: 28px;
            border-radius: 5px;
        }
        #sentenceNumber {
            width: 50px;
            padding: 10px;
            text-align: center;
            border: 3px solid #68838B;
            background: #FFAD5B;
            color: #000;
            border-radius: 10px;
            font-size: 16px;
            -moz-appearance: textfield;
        }
        #sentenceNumber::-webkit-inner-spin-button, 
        #sentenceNumber::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        #sentenceNumber:disabled {
            background: #eee;
        }
        .disabled {
            cursor: not-allowed;
            pointer-events: none;
        }
        .active-mode {
            border: 4px solid orange;
        }
        #vocabIndicator {
            width: 95%;
            max-width: 700px;
            min-height: 50px;
            margin: 10px auto;
            padding: 5px;
            border: 3px solid #734A2E;
            background: #ffffe0;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        #vocabOptionsContainer {
            width: 100%;
            max-width: 700px;
            margin: 10px auto;
        }
        .optionBtn {
            width: 95%;
            max-width: 700px;
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #734A2E;
            background: #ffffff;
            color: #000;
            font-size: 30px;
            text-align: left;
            cursor: pointer;
            border-radius: 5px;
        }
        .optionBtn:hover {
            background: #D2E4C4;
        }
        .correct {
            background: #B7D7AA !important;
        }
        .wrong {
            background: #CE6D5E !important;
        }
        .floating-mode-bar {
            position: fixed;
            bottom: 0px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #68838B;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 0px 5px rgba(0, 0, 0, 1);
            display: flex;
            justify-content: center;
            gap: 20px;
            z-index: 1000;
            width: 900px;
        }
        .mode-button {
            padding: 10px 20px;
            border: 0px solid #ccc;
            background: #95a8ad;
            color: #293437;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 5px;
            transition: border-color 0.3s;
        }
        .mode-button.active {
            border: 2px solid #ffffff;
            background: #f0f0f0;
            color: #293437;
        }
        @media (max-width: 768px) { 
            body {
                margin-bottom: 200px;
            }
            #infoBox { 
                width: 90%; 
                height: 120px; 
                font-size: clamp(30px, 4vw, 40px);
            }
            #contactBox { 
                width: 90%; 
                height: 50px; 
                font-size: clamp(14px, 2vw, 16px);
            }
            .image-frame {
                width: 90%;
                margin: 10px auto 0 auto;
            }
            .content-box {
                margin: 10px auto;
                padding: 20px;
                padding-top: 50px;
                padding-bottom: 90px;
                font-size: 19px;
                line-height: 3.5;
            }
            .translated-word {
                padding: 3px 3px;
            }
            .translation {
                top: -25px;
                font-size: 13px;
            }
            .floating-controls {
                top: 10px;
                right: 10px;
                padding: 5px;
            }
            #vocabControls {
                width: 100%;
                bottom: 50px;
                padding: 5px 0;
            }
            #vocabControls button {
                padding: 6px 6px;
                font-size: 20px;
            }
            #sentenceNumber {
                width: 40px;
                padding: 8px;
                font-size: 14px;
            }
            #vocabIndicator {
                min-height: 40px;
            }
            .optionBtn {
                font-size: 20px;
                padding: 8px;
            }
            .floating-mode-bar {
                width: 100%;
            }
        }
        @media (max-width: 400px) {
            .control-button {
                width: 40px;
                height: 40px;
                font-size: 14px;
            }
            .floating-controls p#timeDisplay {
                font-size: 20px;
            }
            .floating-controls .time-box {
                font-size: 12px;
                min-width: 50px;
            }
        }
    </style>
</head>
<body>
    <div id="infoBox">习得越南语</div>
    <div id="contactBox">讲师-阮玉煌 | Weixin：XiDeYueNanYu</div>
    <div id="contentContainer">
        <div class="image-frame" id="imageFrame">
            <img id="contentImage" src="anhminhhoa.jpg" alt="Content Image">
        </div>
        <div class="content-box" id="content"></div>
    </div>
    <div id="quizContainer">
        <h1>回答下面问题</h1>
        <form id="quizForm">
            <div id="questions"></div>
            <button type="button" id="submitQuiz" onclick="checkAnswers()">提交</button>
        </form>
        <div id="result"></div>
    </div>
    <div id="vocabContainer">
        <div id="vocabIndicator"></div>
        <div id="vocabOptionsContainer"></div>
    </div>
    <div class="floating-controls" id="floatingControls">
        <audio id="audioPlayer" src="lesson.mp3" controls></audio>
        <div class="time-row">
            <p id="timeDisplay">00:00</p>
            <div class="time-box-group">
                <span class="time-box" id="loopStart">--:--</span>
                <span class="time-box" id="loopEnd">--:--</span>
            </div>
            <div class="button-group">
                <button class="control-button loop-button" id="loopButton">听</button>
                <button class="control-button clear-button" id="clearButton">删</button>
            </div>
        </div>
        <div class="tua-buttons">
            <button class="control-button" id="rewind5sButton">-5s</button>
            <button class="control-button" id="rewind1sButton">-1s</button>
            <button class="control-button" id="forward1sButton">+1s</button>
            <button class="control-button" id="forward5sButton">+5s</button>
        </div>
        <div class="action-buttons">
            <button class="control-button pause-play-button" id="pausePlayButton">播</button>
            <button class="control-button toggle-button" id="toggleControlsButton">藏</button>
        </div>
    </div>
    <div id="vocabControls">
        <div>
            <button id="prevBtn">◀</button>
            <input type="text" id="sentenceNumber" inputmode="numeric" pattern="[0-9]*">
            <button id="nextBtn">▶</button>
        </div>
        <div>
            <button id="showHideBtn" class="active-mode">显示-隐藏</button>
            <button id="replayBtn">再听一遍</button>
        </div>
    </div>
    <div class="floating-mode-bar">
        <button class="mode-button active" id="contentMode">内容</button>
        <button class="mode-button" id="quizMode">回答问题</button>
        <button class="mode-button" id="vocabMode">词汇</button>
    </div>

    <audio id="vocabAudio" src="audio.mp3"></audio>
    <audio id="correctAudio" src="Dung.mp3"></audio>
    <audio id="wrongAudio" src="Sai.mp3"></audio>

    <script>

const textContentData = [
    `NHẬT KÝ CỦA DAVID
Mình ở Việt Nam đã gần 3 tháng rồi. Thời gian trôi nhanh thật! Bây giờ, mình đã quen với cuộc sống ở đây. Còn nhớ lúc mới sang, cái gì mình cũng thấy ngạc nhiên, nhiều lúc lo lắng vì cuộc sống ở đây khác với ở Mỹ quá nhiều. Đôi khi mình còn chán nản, thất vọng.
Thế mà bây giờ, mình thấy gắn bó, thân thiết với con người và đất nước này. Mình lấy làm tiếc cho bạn mình, có cơ hội sang Việt Nam mà lại không đi. Đúng là có đi nhiều, sống nhiều ở những vùng khác nhau thì mới hiểu nhiều.
Chính cuộc sống nghèo khó ở những vùng đất Việt Nam đã cho mình những kinh nghiệm quý. Chính ở đây, mình đã học được nhiều điều. Cách nhìn, cách nghĩ của mình đã thay đổi.
Sở dĩ mình nói như vậy là vì bây giờ mình cảm thấy trưởng thành hơn ngày trước. Đặc biệt, tiếng Việt của mình khá hơn nhiều. Mình có thể nghe, nói chuyện, vui đùa với người Việt thoải mái.
Thế là sự cố gắng của mình đã được đền đáp. Mình lấy làm tự hào về điều này và thấy quyết định sang Việt Nam của mình là đúng. Hẳn là bố mẹ và các thầy cô ở Mỹ sẽ rất vui.`
];
const dictionary = {
    "nhật ký": "日记",
    "Việt Nam": "越南",
    "thời gian": "时间",
    "trôi": "流逝",
    "nhanh": "快",
    "quen": "习惯",
    "cuộc sống": "生活",
    "ngạc nhiên": "惊讶",
    "lo lắng": "担心",
    "khác": "不同",
    "Mỹ": "美国",
    "chán nản": "沮丧",
    "thất vọng": "失望",
    "gắn bó": "亲密",
    "thân thiết": "亲近",
    "con người": "人们",
    "đất nước": "国家",
    "tiếc": "遗憾",
    "cơ hội": "机会",
    "hiểu": "理解",
    "nghèo khó": "贫困",
    "vùng đất": "地区",
    "kinh nghiệm": "经验",
    "quý": "宝贵",
    "học": "学习",
    "cách nhìn": "看法",
    "cách nghĩ": "思维方式",
    "thay đổi": "改变",
    "trưởng thành": "成熟",
    "đặc biệt": "特别",
    "tiếng Việt": "越南语",
    "khá": "不错",
    "nghe": "听",
    "nói chuyện": "交谈",
    "vui đùa": "玩耍",
    "thoải mái": "轻松",
    "cố gắng": "努力",
    "đền đáp": "回报",
    "tự hào": "自豪",
    "quyết định": "决定",
    "đúng": "正确",
    "bố mẹ": "父母",
    "thầy cô": "老师",
    "vui": "高兴"
};
const quizData = [
    {
        question: "Theo bài đọc, cảm xúc ban đầu của David khi mới đến Việt Nam là gì?",
        options: ["Phấn khởi và hứng thú", "Tò mò nhưng bình thản", "Lo lắng và đôi khi thất vọng", "Tự tin và thích nghi nhanh"],
        correct: "Lo lắng và đôi khi thất vọng"
    },
    {
        question: "Điều gì làm David cảm thấy tiếc cho bạn mình?",
        options: ["Không có cơ hội học tiếng Việt", "Đã từng sang Việt Nam nhưng không ở lại lâu", "Có cơ hội sang Việt Nam nhưng không đi", "Không thích tìm hiểu về văn hóa châu Á"],
        correct: "Có cơ hội sang Việt Nam nhưng không đi"
    },
    {
        question: "Tác giả cho rằng để “hiểu nhiều” thì cần phải:",
        options: ["Đọc nhiều sách và nghe nhiều ý kiến", "Học tập trong môi trường đại học quốc tế", "Trải nghiệm thực tế ở nhiều vùng khác nhau", "Tự học và quan sát kỹ cuộc sống xung quanh"],
        correct: "Trải nghiệm thực tế ở nhiều vùng khác nhau"
    },
    {
        question: "Theo bài, điều gì đã khiến cách nhìn và cách nghĩ của David thay đổi?",
        options: ["Việc học tiếng Việt hàng ngày", "Sự nghiêm khắc của môi trường sống", "Cuộc sống nghèo khó ở một số vùng đất Việt Nam", "Giao lưu với nhiều người bạn quốc tế"],
        correct: "Cuộc sống nghèo khó ở một số vùng đất Việt Nam"
    },
    {
        question: "Câu “Sở dĩ mình nói như vậy là vì bây giờ mình cảm thấy trưởng thành hơn ngày trước” cho thấy điều gì?",
        options: ["David nhận thấy sự thay đổi tích cực trong bản thân sau một thời gian sống ở Việt Nam", "David muốn nhấn mạnh rằng cuộc sống ở Mỹ dễ chịu hơn", "David cảm thấy buồn vì phải xa quê hương", "David thất vọng với môi trường học tập ở Việt Nam"],
        correct: "David nhận thấy sự thay đổi tích cực trong bản thân sau một thời gian sống ở Việt Nam"
    },
    {
        question: "Thái độ hiện tại của David đối với Việt Nam là gì?",
        options: ["Chán nản và muốn về Mỹ sớm", "Trung lập và chỉ đang quan sát", "Gắn bó và hài lòng với cuộc sống tại đây", "Phê phán một số điều bất tiện trong xã hội"],
        correct: "Gắn bó và hài lòng với cuộc sống tại đây"
    },
    {
        question: "Theo bài, điều gì khiến David cảm thấy tự hào?",
        options: ["Anh đã có nhiều bạn Việt Nam", "Anh đã đi du lịch nhiều nơi ở Việt Nam", "Anh đã cải thiện rõ rệt trình độ tiếng Việt của mình", "Anh đã tổ chức các lớp dạy tiếng Anh miễn phí"],
        correct: "Anh đã cải thiện rõ rệt trình độ tiếng Việt của mình"
    },
    {
        question: "Câu “Mình thấy quyết định sang Việt Nam của mình là đúng” phản ánh điều gì?",
        options: ["David cảm thấy may mắn vì không học ở nước khác", "David đánh giá cao giá trị trải nghiệm tại Việt Nam", "David không muốn quay về Mỹ", "David khuyên bạn bè không nên bỏ lỡ cơ hội sang Việt Nam"],
        correct: "David đánh giá cao giá trị trải nghiệm tại Việt Nam"
    },
    {
        question: "David kỳ vọng ai sẽ vui khi biết kết quả học tập và trưởng thành của mình?",
        options: ["Các bạn học cũ ở Mỹ", "Những người bạn Việt Nam", "Gia đình và thầy cô ở Mỹ", "Thầy cô và bạn học tại Việt Nam"],
        correct: "Gia đình và thầy cô ở Mỹ"
    },
    {
        question: "Câu “Chính ở đây, mình đã học được nhiều điều” có thể hiểu là gì?",
        options: ["David đánh giá cao nền giáo dục Việt Nam", "Những trải nghiệm sống tại Việt Nam mang lại cho anh nhiều bài học sâu sắc", "David học tốt tiếng Việt nhờ chương trình giảng dạy hiện đại", "David đã hoàn thành một khóa học tại trường đại học Việt Nam"],
        correct: "Những trải nghiệm sống tại Việt Nam mang lại cho anh nhiều bài học sâu sắc"
    },
    {
        question: "Có thể suy ra điều gì từ câu chuyện của David?",
        options: ["Những thay đổi lớn trong nhận thức thường đến từ trải nghiệm cá nhân sâu sắc", "Chỉ có học tập ở nước ngoài mới giúp trưởng thành", "Học tiếng Việt là con đường duy nhất để hiểu văn hóa Việt", "Cuộc sống ở Mỹ dễ thích nghi hơn so với Việt Nam"],
        correct: "Những thay đổi lớn trong nhận thức thường đến từ trải nghiệm cá nhân sâu sắc"
    },
    {
        question: "Mục đích chính của bài viết là gì?",
        options: ["Giới thiệu về chương trình trao đổi sinh viên Mỹ - Việt", "Kể lại hành trình học tiếng Việt của một sinh viên Mỹ", "Chia sẻ trải nghiệm cá nhân để thể hiện sự trưởng thành và gắn bó với Việt Nam", "Phân tích sự khác biệt văn hóa giữa Mỹ và Việt Nam"],
        correct: "Chia sẻ trải nghiệm cá nhân để thể hiện sự trưởng thành và gắn bó với Việt Nam"
    }
];
const sentences = [
    {
        "audioFile": "audio.mp3",
        "start": 0.429932,
        "end": 1.629932,
        "correctAnswer": "nhật ký",
        "translation": "日记",
        "options": [
            "nhậc ký",
            "nhật kỷ",
            "nhạt ký",
            "nhật ký"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 2.759932,
        "end": 3.579932,
        "correctAnswer": "trôi",
        "translation": "流逝",
        "options": [
            "trối",
            "trôi",
            "chôi",
            "troi"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 4.399932,
        "end": 5.579932,
        "correctAnswer": "chán nản",
        "translation": "沮丧",
        "options": [
            "chán nản",
            "chản nán",
            "chán nãn",
            "chám nản"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 6.489932,
        "end": 7.559932,
        "correctAnswer": "thất vọng",
        "translation": "失望",
        "options": [
            "thắt vọng",
            "thất vong",
            "thất vọng",
            "thât vọng"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 8.469932,
        "end": 9.759932,
        "correctAnswer": "gắn bó",
        "translation": "亲密",
        "options": [
            "gắn bó",
            "gắng bó",
            "gắn bỗ",
            "gẳn bó"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 10.509932,
        "end": 11.649932,
        "correctAnswer": "thân thiết",
        "translation": "亲近",
        "options": [
            "thân thiêt",
            "thân thiết",
            "thân thiệt",
            "than thiết"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 12.559932,
        "end": 13.709932,
        "correctAnswer": "con người",
        "translation": "人们",
        "options": [
            "con ngưởi",
            "cơn người",
            "con người",
            "con ngưòi"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 14.529932,
        "end": 15.199932,
        "correctAnswer": "tiếc",
        "translation": "遗憾",
        "options": [
            "tiếc",
            "tiéc",
            "tiếk",
            "téc"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 16.009932,
        "end": 17.019932,
        "correctAnswer": "cơ hội",
        "translation": "机会",
        "options": [
            "cơ hôi",
            "cờ hội",
            "cơ hội",
            "cơ hổi"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 17.809932,
        "end": 18.659932,
        "correctAnswer": "hiểu",
        "translation": "理解",
        "options": [
            "hiễu",
            "hiểu",
            "hểu",
            "hiểl"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 19.529932,
        "end": 20.769932,
        "correctAnswer": "nghèo khó",
        "translation": "贫困",
        "options": [
            "nghèo kho",
            "nghèo khõ",
            "nghèo khó",
            "nghèo khô"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 21.539932,
        "end": 22.529932,
        "correctAnswer": "vùng đất",
        "translation": "地区",
        "options": [
            "vùng đất",
            "vừng đất",
            "vùng đắt",
            "vùn đất"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 23.549932,
        "end": 24.619932,
        "correctAnswer": "kinh nghiệm",
        "translation": "经验",
        "options": [
            "kinh nghiêm",
            "kinh nghiệm",
            "kinh ngiệm",
            "khinh nghiệm"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 25.649932,
        "end": 26.339932,
        "correctAnswer": "quý",
        "translation": "宝贵",
        "options": [
            "quí",
            "quý",
            "quýy",
            "quỳ"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 27.189932,
        "end": 28.219932,
        "correctAnswer": "cách nhìn",
        "translation": "看法",
        "options": [
            "cách nhin",
            "cạch nhìn",
            "cách nhìn",
            "cách nình"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 29.109932,
        "end": 30.179932,
        "correctAnswer": "cách nghĩ",
        "translation": "思维方式",
        "options": [
            "cách nghĩ",
            "cách ngĩ",
            "cạch ngĩ",
            "cắt nghĩ"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 31.029932,
        "end": 31.979932,
        "correctAnswer": "thay đổi",
        "translation": "改变",
        "options": [
            "thay dổi",
            "thay đổi",
            "thay dọi",
            "thay đôỉ"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 32.969932,
        "end": 33.979932,
        "correctAnswer": "trưởng thành",
        "translation": "成熟",
        "options": [
            "trưởng thảnh",
            "trưởng thành",
            "trượng thành",
            "trường thành"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 34.949932,
        "end": 35.929932,
        "correctAnswer": "đặc biệt",
        "translation": "特别",
        "options": [
            "đặc biệt",
            "đắc biệt",
            "đặc biêt",
            "đặc bệt"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 36.909932,
        "end": 37.979932,
        "correctAnswer": "tiếng Việt",
        "translation": "越南语",
        "options": [
            "tiếng Vịêt",
            "tiếng Viêt",
            "tiếng Việt",
            "tiêng Việt"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 39.029932,
        "end": 40.139932,
        "correctAnswer": "nói chuyện",
        "translation": "交谈",
        "options": [
            "nói chuyền",
            "nối chuyện",
            "nói chuyện",
            "nói chụyện"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 41.049932,
        "end": 42.109932,
        "correctAnswer": "vui đùa",
        "translation": "玩耍",
        "options": [
            "vui đùa",
            "vui đuà",
            "vuy đùa",
            "vui dùa"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 42.959932,
        "end": 44.069932,
        "correctAnswer": "thoải mái",
        "translation": "轻松",
        "options": [
            "thoài mái",
            "thoải mải",
            "thoải mái",
            "thỏaí mái"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 44.949932,
        "end": 45.909932,
        "correctAnswer": "cố gắng",
        "translation": "努力",
        "options": [
            "cổ gắng",
            "cố gắng",
            "cố gẳn",
            "cố gán"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 46.979932,
        "end": 48.009932,
        "correctAnswer": "đền đáp",
        "translation": "回报",
        "options": [
            "đền đạp",
            "đền đáp",
            "đền dáp",
            "đền đấp"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 49.059932,
        "end": 50.099932,
        "correctAnswer": "tự hào",
        "translation": "自豪",
        "options": [
            "tự hảo",
            "tự hào",
            "tự hàu",
            "tự hòa"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 50.999932,
        "end": 51.879932,
        "correctAnswer": "quyết định",
        "translation": "决定",
        "options": [
            "quyêt định",
            "quyết dịnh",
            "quyết định",
            "quết định"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 52.879932,
        "end": 53.589932,
        "correctAnswer": "đúng",
        "translation": "正确",
        "options": [
            "đúng",
            "đung",
            "dúng",
            "đứn"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 54.409932,
        "end": 55.519932,
        "correctAnswer": "thầy cô",
        "translation": "老师",
        "options": [
            "thầy cỗ",
            "thầy cô",
            "thây cô",
            "thay cô"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 56.209932,
        "end": 57.319932,
        "correctAnswer": "ngạc nhiên",
        "translation": "惊讶",
        "options": [
            "ngạc nhiên",
            "ngạc nhiện",
            "ngạt nhiên",
            "ngạc nhien"
        ]
    }
];

        // Xử lý hiển thị văn bản với từ điển
        const content = document.getElementById('content');
        function renderText() {
            let html = textContentData[0].replace(/\n/g, "<br>");
            const sortedKeys = Object.keys(dictionary).sort((a, b) => b.length - a.length);
            const replacements = [];

            sortedKeys.forEach(key => {
                const regex = new RegExp(`(\\b|[.,!?\\n\\s]|^)(${key.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})(\\b|[.,!?\\n\\s]|$)`, 'gi');
                let match;
                while ((match = regex.exec(html)) !== null) {
                    const start = match.index + match[1].length;
                    const end = start + match[2].length;
                    replacements.push({
                        start,
                        end,
                        original: match[2],
                        prefix: match[1],
                        suffix: match[3],
                        translation: dictionary[key]
                    });
                }
            });

            replacements.sort((a, b) => a.start - b.start);
            const filteredReplacements = [];
            let lastEnd = -1;
            for (const replacement of replacements) {
                if (replacement.start >= lastEnd) {
                    filteredReplacements.push(replacement);
                    lastEnd = replacement.end;
                }
            }

            for (let i = filteredReplacements.length - 1; i >= 0; i--) {
                const { start, end, original, prefix, suffix, translation } = filteredReplacements[i];
                const translatedHtml = `${prefix}<span class="translated-word"><span class="translation">${translation}</span><span class="original">${original}</span></span>${suffix}`;
                html = html.slice(0, start - prefix.length) + translatedHtml + html.slice(end + suffix.length);
            }

            content.innerHTML = html;
        }

        // Xử lý hiển thị ảnh
        const imageFrame = document.getElementById('imageFrame');
        const contentImage = document.getElementById('contentImage');
        const imageSrc = "anhminhhoa.jpg";
        function renderImage() {
            if (imageSrc) {
                contentImage.src = imageSrc;
                imageFrame.style.display = 'block';
            } else {
                imageFrame.style.display = 'none';
            }
        }

        // Xử lý audio và bảng điều khiển
        const audioPlayer = document.getElementById("audioPlayer");
        const floatingControls = document.getElementById("floatingControls");
        if (!floatingControls) {
            console.error('Không tìm thấy floatingControls');
        }
        const timeDisplay = floatingControls ? floatingControls.querySelector("#timeDisplay") : null;
        const loopStart = floatingControls ? floatingControls.querySelector("#loopStart") : null;
        const loopEnd = floatingControls ? floatingControls.querySelector("#loopEnd") : null;
        const loopButton = floatingControls ? floatingControls.querySelector("#loopButton") : null;
        const clearButton = floatingControls ? floatingControls.querySelector("#clearButton") : null;
        const rewind5sButton = floatingControls ? floatingControls.querySelector("#rewind5sButton") : null;
        const rewind1sButton = floatingControls ? floatingControls.querySelector("#rewind1sButton") : null;
        const forward1sButton = floatingControls ? floatingControls.querySelector("#forward1sButton") : null;
        const forward5sButton = floatingControls ? floatingControls.querySelector("#forward5sButton") : null;
        const pausePlayButton = floatingControls ? floatingControls.querySelector("#pausePlayButton") : null;
        const toggleControlsButton = floatingControls ? floatingControls.querySelector("#toggleControlsButton") : null;
        const tuaButtons = floatingControls ? floatingControls.querySelector(".tua-buttons") : null;

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function updateTimeDisplay(displayElement) {
            if (displayElement) {
                displayElement.textContent = formatTime(audioPlayer.currentTime);
            }
        }

        let customLoopStart = null;
        let customLoopEnd = null;
        let clickCount = 0;
        let isLooping = false;

        if (timeDisplay) {
            const updateInterval = setInterval(() => updateTimeDisplay(timeDisplay), 1000);
            timeDisplay.onclick = () => {
                if (audioPlayer.paused) {
                    clickCount++;
                    if (clickCount === 1) {
                        customLoopStart = audioPlayer.currentTime;
                        loopStart.textContent = formatTime(customLoopStart);
                    } else if (clickCount === 2) {
                        customLoopEnd = audioPlayer.currentTime;
                        if (customLoopEnd <= customLoopStart) {
                            customLoopEnd = null;
                            loopEnd.textContent = "--:--";
                        } else {
                            loopEnd.textContent = formatTime(customLoopEnd);
                        }
                        clickCount = 0;
                    }
                }
            };
        }

        if (audioPlayer) {
            audioPlayer.ontimeupdate = function() {
                updateTimeDisplay(timeDisplay);
                if (isLooping && customLoopStart !== null && customLoopEnd !== null) {
                    if (audioPlayer.currentTime >= customLoopEnd) {
                        audioPlayer.currentTime = customLoopStart;
                    }
                }
            };
        }

        if (rewind5sButton) {
            rewind5sButton.onclick = () => {
                if (!isLooping) {
                    audioPlayer.currentTime = Math.max(0, audioPlayer.currentTime - 5);
                    updateTimeDisplay(timeDisplay);
                }
            };
        }
        if (rewind1sButton) {
            rewind1sButton.onclick = () => {
                if (!isLooping) {
                    audioPlayer.currentTime = Math.max(0, audioPlayer.currentTime - 1);
                    updateTimeDisplay(timeDisplay);
                }
            };
        }
        if (forward1sButton) {
            forward1sButton.onclick = () => {
                if (!isLooping) {
                    audioPlayer.currentTime = Math.min(audioPlayer.duration, audioPlayer.currentTime + 1);
                    updateTimeDisplay(timeDisplay);
                }
            };
        }
        if (forward5sButton) {
            forward5sButton.onclick = () => {
                if (!isLooping) {
                    audioPlayer.currentTime = Math.min(audioPlayer.duration, audioPlayer.currentTime + 5);
                    updateTimeDisplay(timeDisplay);
                }
            };
        }

        if (pausePlayButton) {
            pausePlayButton.onclick = () => {
                if (audioPlayer.paused) {
                    audioPlayer.play();
                    pausePlayButton.textContent = "停";
                } else {
                    audioPlayer.pause();
                    pausePlayButton.textContent = "播";
                }
            };
        }

        if (loopButton) {
            loopButton.onclick = () => {
                if (customLoopStart !== null && customLoopEnd !== null) {
                    audioPlayer.currentTime = customLoopStart;
                    audioPlayer.play();
                    isLooping = true;
                    if (rewind5sButton) rewind5sButton.disabled = true;
                    if (rewind1sButton) rewind1sButton.disabled = true;
                    if (forward1sButton) forward1sButton.disabled = true;
                    if (forward5sButton) forward5sButton.disabled = true;
                }
            };
        }

        if (clearButton) {
            clearButton.onclick = () => {
                customLoopStart = null;
                customLoopEnd = null;
                if (loopStart) loopStart.textContent = "--:--";
                if (loopEnd) loopEnd.textContent = "--:--";
                clickCount = 0;
                isLooping = false;
                if (rewind5sButton) rewind5sButton.disabled = false;
                if (rewind1sButton) rewind1sButton.disabled = false;
                if (forward1sButton) forward1sButton.disabled = false;
                if (forward5sButton) forward5sButton.disabled = false;
            };
        }

        let controlsVisible = true;
        if (toggleControlsButton) {
            toggleControlsButton.onclick = () => {
                if (controlsVisible) {
                    if (timeDisplay) timeDisplay.style.display = "none";
                    if (tuaButtons) tuaButtons.style.display = "none";
                    if (pausePlayButton) pausePlayButton.style.display = "none";
                    if (loopStart) loopStart.style.display = "none";
                    if (loopEnd) loopEnd.style.display = "none";
                    if (loopButton) loopButton.style.display = "none";
                    if (clearButton) clearButton.style.display = "none";
                    toggleControlsButton.textContent = "示";
                    controlsVisible = false;
                } else {
                    if (timeDisplay) timeDisplay.style.display = "inline-block";
                    if (tuaButtons) tuaButtons.style.display = "flex";
                    if (pausePlayButton) pausePlayButton.style.display = "inline-flex";
                    if (loopStart) loopStart.style.display = "inline-block";
                    if (loopEnd) loopEnd.style.display = "inline-block";
                    if (loopButton) loopButton.style.display = "inline-flex";
                    if (clearButton) clearButton.style.display = "inline-flex";
                    toggleControlsButton.textContent = "藏";
                    controlsVisible = true;
                }
            };
        }

        if (audioPlayer) {
            audioPlayer.onpause = audioPlayer.onended = function() {
                if (pausePlayButton) pausePlayButton.textContent = "播";
            };
        }

        // Xử lý chế độ từ vựng
        const vocabAudio = document.getElementById('vocabAudio');
        const correctAudio = document.getElementById('correctAudio');
        const wrongAudio = document.getElementById('wrongAudio');
        const vocabIndicator = document.getElementById('vocabIndicator');
        const sentenceNumber = document.getElementById('sentenceNumber');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const replayBtn = document.getElementById('replayBtn');
        const showHideBtn = document.getElementById('showHideBtn');
        const vocabOptionsContainer = document.getElementById('vocabOptionsContainer');

        let currentIndex = 0;
        let showAnswer = true;
        let isPlaying = false;

        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function updateVocabDisplay() {
            if (sentenceNumber) sentenceNumber.value = currentIndex + 1;
            if (vocabIndicator) {
                vocabIndicator.style.background = '#ffffe0';
                vocabIndicator.innerHTML = showAnswer ? `
                    <div style="font-size: 20px; font-weight: normal; color: #38761d;">${sentences[currentIndex].translation}</div>
                ` : '';
            }
            updateVocabOptions();
            playCurrentSentence();
        }

        function updateVocabOptions() {
            if (vocabOptionsContainer) {
                vocabOptionsContainer.innerHTML = '';
                const shuffledOptions = shuffleArray(sentences[currentIndex].options);
                shuffledOptions.forEach(option => {
                    const btn = document.createElement('button');
                    btn.className = 'optionBtn';
                    btn.textContent = option;
                    btn.onclick = () => checkVocabAnswer(option);
                    vocabOptionsContainer.appendChild(btn);
                });
            }
        }

        function playCurrentSentence() {
            if (isPlaying) vocabAudio.pause();
            [prevBtn, nextBtn, replayBtn, showHideBtn].forEach(btn => btn && btn.classList.add('disabled'));
            if (sentenceNumber) sentenceNumber.disabled = true;
            isPlaying = true;
            vocabAudio.src = sentences[currentIndex].audioFile;
            vocabAudio.currentTime = sentences[currentIndex].start;
            vocabAudio.play().catch(error => {
                console.error('Audio playback failed:', error);
                alert('Vui lòng nhấn nút “再听一遍” để phát âm thanh.');
                [prevBtn, nextBtn, replayBtn, showHideBtn].forEach(btn => btn && btn.classList.remove('disabled'));
                if (sentenceNumber) sentenceNumber.disabled = false;
                isPlaying = false;
            });

            vocabAudio.ontimeupdate = () => {
                if (vocabAudio.currentTime >= sentences[currentIndex].end) {
                    vocabAudio.pause();
                    vocabAudio.ontimeupdate = null;
                    [prevBtn, nextBtn, replayBtn, showHideBtn].forEach(btn => btn && btn.classList.remove('disabled'));
                    if (sentenceNumber) sentenceNumber.disabled = false;
                    isPlaying = false;
                }
            };
        }

        function moveSentence(direction) {
            currentIndex = (currentIndex + direction + sentences.length) % sentences.length;
            updateVocabDisplay();
        }

        function checkVocabAnswer(selectedAnswer) {
            const correctAnswer = sentences[currentIndex].correctAnswer;
            const optionButtons = vocabOptionsContainer.getElementsByClassName('optionBtn');

            for (let btn of optionButtons) {
                btn.classList.remove('correct', 'wrong');
                if (btn.textContent === selectedAnswer) {
                    if (selectedAnswer === correctAnswer) {
                        vocabIndicator.style.background = '#B7D7AA';
                        btn.classList.add('correct');
                        correctAudio.play().catch(error => console.error('Correct audio playback failed:', error));
                        correctAudio.onended = () => {
                            setTimeout(() => moveSentence(1), 200);
                        };
                    } else {
                        vocabIndicator.style.background = '#CE6D5E';
                        btn.classList.add('wrong');
                        wrongAudio.play().catch(error => console.error('Wrong audio playback failed:', error));
                        wrongAudio.onended = null;
                    }
                }
            }
        }

        if (prevBtn) {
            prevBtn.onclick = () => {
                if (!isPlaying) moveSentence(-1);
            };
        }

        if (nextBtn) {
            nextBtn.onclick = () => {
                if (!isPlaying) moveSentence(1);
            };
        }

        if (replayBtn) {
            replayBtn.onclick = () => {
                if (!isPlaying) playCurrentSentence();
            };
        }

        if (showHideBtn) {
            showHideBtn.onclick = () => {
                if (!isPlaying) {
                    showAnswer = !showAnswer;
                    showHideBtn.classList.toggle('active-mode');
                    updateVocabDisplay();
                }
            };
        }

        if (sentenceNumber) {
            sentenceNumber.onchange = () => {
                if (!isPlaying) {
                    const num = parseInt(sentenceNumber.value) - 1;
                    if (!isNaN(num) && num >= 0 && num < sentences.length) {
                        currentIndex = num;
                        updateVocabDisplay();
                    } else {
                        alert(`输入范围： 1 到 ${sentences.length}`);
                        updateVocabDisplay();
                    }
                }
            };

            sentenceNumber.onkeydown = (e) => {
                if (!isPlaying) {
                    if (e.key === 'ArrowLeft') moveSentence(-1);
                    if (e.key === 'ArrowRight') moveSentence(1);
                }
            };
        }

        function initVocab() {
            currentIndex = 0;
            showAnswer = true;
            isPlaying = false;
            updateVocabDisplay();
        }

        // Xử lý câu hỏi
        let contentScrollPosition = 0;
        let quizScrollPosition = 0;
        let vocabScrollPosition = 0;
        let userSelections = {};
        let isSubmitted = false;

        function loadQuiz() {
            const questionsDiv = document.getElementById('questions');
            if (questionsDiv) {
                questionsDiv.innerHTML = '';
                quizData.forEach((item, index) => {
                    const questionDiv = document.createElement('div');
                    questionDiv.className = 'question';
                    const questionTitle = document.createElement('h3');
                    questionTitle.textContent = `Câu ${index + 1}: ${item.question}`;
                    questionDiv.appendChild(questionTitle);

                    const optionsDiv = document.createElement('div');
                    optionsDiv.className = 'options';
                    item.options.forEach(option => {
                        const label = document.createElement('label');
                        const isChecked = userSelections[`question${index}`] === option ? 'checked' : '';
                        label.innerHTML = `
                            <input type="radio" name="question${index}" value="${option}" ${isChecked}>
                            ${option}
                        `;
                        optionsDiv.appendChild(label);
                    });

                    questionDiv.appendChild(optionsDiv);
                    questionsDiv.appendChild(questionDiv);
                });
                window.scrollTo(0, quizScrollPosition);
            }
        }

        function saveSelections() {
            quizData.forEach((_, index) => {
                const selected = document.querySelector(`input[name="question${index}"]:checked`);
                if (selected) {
                    userSelections[`question${index}`] = selected.value;
                }
            });
        }

        function checkAnswers() {
            let score = 0;
            const total = quizData.length;
            let wrongAnswers = [];
            quizData.forEach((item, index) => {
                const selected = document.querySelector(`input[name="question${index}"]:checked`);
                if (selected) {
                    if (selected.value === item.correct) {
                        score++;
                    } else {
                        wrongAnswers.push({
                            question: item.question,
                            selected: selected.value,
                            correct: item.correct
                        });
                    }
                } else {
                    wrongAnswers.push({
                        question: item.question,
                        selected: "未选择",
                        correct: item.correct
                    });
                }
            });

            const resultDiv = document.getElementById('result');
            if (resultDiv) {
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = `
                    <h3>YD-
NKCDV
-结果: ${score}/${total} 答案正确</h3>
                    <p>比例: ${(score/total * 100).toFixed(2)}%</p>
                `;
                if (wrongAnswers.length > 0) {
                    resultDiv.innerHTML += '<h4>错误答案:</h4>';
                    wrongAnswers.forEach((wrong, index) => {
                        resultDiv.innerHTML += `
                            <div class="wrong-answer">
                                Câu ${quizData.findIndex(q => q.question === wrong.question) + 1}: ${wrong.question}<br>
                                你的选择: ${wrong.selected} - 正确答案: ${wrong.correct}
                            </div>
                        `;
                    });
                } else {
                    resultDiv.innerHTML += '<p>回答正确所有问题</p>';
                }
                resultDiv.scrollIntoView({ behavior: 'smooth' });
                isSubmitted = true;
            }
        }

        // Xử lý chế độ hiển thị
        const contentModeButton = document.getElementById('contentMode');
        const quizModeButton = document.getElementById('quizMode');
        const vocabModeButton = document.getElementById('vocabMode');
        const contentContainer = document.getElementById('contentContainer');
        const quizContainer = document.getElementById('quizContainer');
        const vocabContainer = document.getElementById('vocabContainer');
        const vocabControls = document.getElementById('vocabControls');

        if (contentModeButton) {
            contentModeButton.addEventListener('click', () => {
                quizScrollPosition = window.scrollY;
                vocabScrollPosition = window.scrollY;
                saveSelections();
                contentContainer.style.display = 'block';
                quizContainer.style.display = 'none';
                vocabContainer.style.display = 'none';
                vocabControls.style.display = 'none';
                contentModeButton.classList.add('active');
                quizModeButton.classList.remove('active');
                vocabModeButton.classList.remove('active');
                floatingControls.style.display = 'block';
                renderText();
                renderImage();
                window.scrollTo(0, contentScrollPosition);
            });
        }

        if (quizModeButton) {
            quizModeButton.addEventListener('click', () => {
                contentScrollPosition = window.scrollY;
                vocabScrollPosition = window.scrollY;
                saveSelections();
                contentContainer.style.display = 'none';
                quizContainer.style.display = 'block';
                vocabContainer.style.display = 'none';
                vocabControls.style.display = 'none';
                quizModeButton.classList.add('active');
                contentModeButton.classList.remove('active');
                vocabModeButton.classList.remove('active');
                floatingControls.style.display = 'none';
                if (isSubmitted) {
                    userSelections = {};
                    isSubmitted = false;
                }
                loadQuiz();
            });
        }

        if (vocabModeButton) {
            vocabModeButton.addEventListener('click', () => {
                contentScrollPosition = window.scrollY;
                quizScrollPosition = window.scrollY;
                saveSelections();
                contentContainer.style.display = 'none';
                quizContainer.style.display = 'none';
                vocabContainer.style.display = 'block';
                vocabControls.style.display = 'block';
                vocabModeButton.classList.add('active');
                contentModeButton.classList.remove('active');
                quizModeButton.classList.remove('active');
                floatingControls.style.display = 'none';
                initVocab();
                window.scrollTo(0, vocabScrollPosition);
            });
        }

        // Khởi tạo
        document.addEventListener('DOMContentLoaded', () => {
            renderText();
            renderImage();
            contentContainer.style.display = 'block';
            quizContainer.style.display = 'none';
            vocabContainer.style.display = 'none';
            vocabControls.style.display = 'none';
        });
    </script>
</body>
</html>
